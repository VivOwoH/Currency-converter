/*
 * This Java source file was generated by the Gradle 'init' task.
 */
package a1;

import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;

import static org.junit.jupiter.api.Assertions.*;

import org.junit.jupiter.api.AfterAll;

class AppTest {

    private Syst system;

    @BeforeEach
    public void setUp() {
        system = new Syst();
        system.systemInit(); // instantiate it before every test
    }

    // ---------------------------------------------
    // ---------------- Data ----------------------
    // ---------------------------------------------
    @Test
    void testDataGetInfoExistingRate() {
        String string = Data.getInfo(system, "AUD", "USD");
        String[] test = string.split(" ");
        assertEquals(test[0], "AUD");
        assertEquals(test[1], "USD");
    }

    @Test
    void testDataGetInfoNewRate() {

    }

    // ---------------------------------------------
    // ---------------- Admin ----------------------
    // ---------------------------------------------
    @Test
    void testAdminWriteExistingCountry() {
        system.getAdminInstance().addRate("AUD", "USD", 1.2);
        String string = Data.getInfo(system, "AUD", "USD");
        String[] test = string.split(" ");
        assertEquals(test[0], "AUD");
        assertEquals(test[1], "USD");
        assertEquals(test[2], "1.20");
    }

    @Test
    void testAdminWriteNewCountry() {
        system.getAdminInstance().addRate("ZIM", "USD", 1.2);
        String string = Data.getInfo(system, "ZIM", "USD");
        String[] test = string.split(" ");
        assertEquals(test[0], "ZIM");
        assertEquals(test[1], "USD");
        assertEquals(test[2], "1.20");
    }

    // ---------------------------------------------
    // ---------------- User -----------------------
    // ---------------------------------------------

    @Test
    void testUserConvertMoney() {
        system.getDataInstance().updateCurrencyTable(system);
        // on UI (included in popular table)
        double test_result_1 = system.getUserInstance().convertMoney("JPY", "GBP", 1.00);
        assertEquals(1.00 * 0.01, test_result_1);

        // internal data (included in currency table only)
        double test_result_2 = system.getUserInstance().convertMoney("USD", "AUD", 1.00);
        assertEquals(1.00 * 1.47, test_result_2);
    }

    @Test 
    void testUserCompareRate() {
        // USD - EUR: initial 0.99

        // test no previous data
        assertTrue(-2 == system.getUserInstance().compareRate(0.99, "USD", "EUR"));
        
        // test no change
        system.getAdminInstance().addRate("USD", "EUR", 0.99);
        assertTrue(0 == system.getUserInstance().compareRate(0.99, "USD", "EUR"));
        
        // test increase
        system.getAdminInstance().addRate("USD", "EUR", 5.0);
        assertTrue(1 == system.getUserInstance().compareRate(5.0, "USD", "EUR"));
        
        // test decrease
        system.getAdminInstance().addRate("USD", "EUR", 3.0);
        assertTrue(-1 == system.getUserInstance().compareRate(3.0, "USD", "EUR"));
        
    }

    /*
     * 0.0|1.01|1.16|0.01|
        0.99|0.0|1.15|0.01|
        0.86|0.87|0.0|0.01|
        139.44|140.85|162.14|0.0|  -- verify initial popular currency
     */
    @Test
    void testUserDisplayPopularCurrencyTable() {
        // Initial table
        String[][] expectedTable = {
                                    {"0.0", "1.01", "1.16", "0.01"},
                                    {"0.99", "0.0", "1.15", "0.01"},
                                    {"0.86", "0.87", "0.0", "0.01"},
                                    {"139.44", "140.85", "162.14", "0.0"}
                                };
        String[][] actualTable = system.getUserInstance().displayPopularCurrency();
        for (int i = 0; i < actualTable.length; i++) {
            for (int j = 0; j < actualTable[0].length; j++) {
                assertEquals(expectedTable[i][j], actualTable[i][j]);
            }
        }

        // After changing rate (i.e. showing I/D)

    }
}
